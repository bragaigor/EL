PerfIterativeFib

DEF main 0
	// Call fib(10000000) 20 times and print the time taken for each iteration
	PUSH_CONSTANT 20
	POP_LOCAL 2
	PUSH_CONSTANT 0
	POP_LOCAL 1
LOOP_START:
	PUSH_CONSTANT 10000000
	CURRENT_TIME
	POP_LOCAL 0
	CALL iterFib 1
	POP
	CURRENT_TIME
	PUSH_LOCAL 0
	SUB
	POP_LOCAL 0
	PRINT_STRING "Fib(10000000) executed in "
	PUSH_LOCAL 0
	PRINT_INT64
	PRINT_STRING "ms\n"

	PUSH_LOCAL 1
	PUSH_CONSTANT 1
	ADD
	DUP
	POP_LOCAL 1
	PUSH_LOCAL 2
	JMPL LOOP_START
	
	
	PUSH_CONSTANT 1
	RET
end

DEF iterFib 1
	PUSH_ARG 0
	DUP
	POP_LOCAL 0
	PUSH_CONSTANT 1
	JMPL L1
	PUSH_CONSTANT 1
	POP_LOCAL 1
	PUSH_CONSTANT 0
	POP_LOCAL 2
	PUSH_CONSTANT 1
	POP_LOCAL 3
L2:
	PUSH_LOCAL 1
	PUSH_LOCAL 2
	PUSH_LOCAL 1
	POP_LOCAL 2
	ADD
	POP_LOCAL 1
	PUSH_LOCAL 3
	PUSH_CONSTANT 1
	ADD
	DUP
	POP_LOCAL 3
	PUSH_LOCAL 0
	JMPL L2
	PUSH_LOCAL 1
	RET
L1:
	PUSH_LOCAL 0
	RET
end
