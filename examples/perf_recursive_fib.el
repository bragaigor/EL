PerfRecursiveFib

DEF main 0
	// Call fib(33) 20 times and print the time taken for each iteration
	PUSH_CONSTANT 20
	POP_LOCAL 2
	PUSH_CONSTANT 0
	POP_LOCAL 1
LOOP_START:
	PUSH_CONSTANT 33
	CURRENT_TIME
	POP_LOCAL 0
	CALL fib 1
	POP
	CURRENT_TIME
	PUSH_LOCAL 0
	SUB
	POP_LOCAL 0
	PRINT_STRING "Fib(33) executed in "
	PUSH_LOCAL 0
	PRINT_INT64
	PRINT_STRING "ms\n"
	PUSH_LOCAL 1
	PUSH_CONSTANT 1
	ADD
	DUP
	POP_LOCAL 1
	PUSH_LOCAL 2
	JMPL LOOP_START
	
	PUSH_CONSTANT 1
	RET
end

DEF fib 1
	PUSH_ARG 0
	DUP
	POP_LOCAL 0
	PUSH_CONSTANT 2
	JMPL B2
	PUSH_LOCAL 0
	PUSH_CONSTANT 1
	SUB
	CALL fib 1
	POP_LOCAL 1
	PUSH_LOCAL 0
	PUSH_CONSTANT 2
	SUB
	CALL fib 1
	POP_LOCAL 0
	PUSH_LOCAL 1
	PUSH_LOCAL 0
	ADD
	RET
B2:
	PUSH_LOCAL 0
	RET
end

